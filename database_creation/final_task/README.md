Цель работы

Разработать базу данных под конкретный проект и написать типовые сервисные запросы к ней.

Кейс

Разрабатывается система подписки на астрологические прогнозы. Пользователи регистрируются в системе, используя email в качестве логина. Пользователь предоставляет дату и время рождения для расчета прогнозов.

В каталоге перечислены виды прогнозов (например, по знаку зодиака, китайский, цыганский и т. д.). Для каждого вида прогнозов установлена цена на месячную подписку. Каждая подписка начинается с 1 числа некоторого месяца и имеет длительность в целое число месяцев.

Любой пользователь может подписаться на любое количество прогнозов разных видов. Например, на март 2022 года — на китайский и цыганский, на полгода с апреля по сентябрь 2022 года — на китайский, помесячно на май, июнь и июль 2022 года — на прогноз по знаку зодиака.

Ограничения: для новых подписок дата их начала может быть не ранее завершения всех действующих подписок на этот вид прогноза. Например, пользователь из примера выше может подписаться на китайский гороскоп только с октября 2022 года или позже, на цыганский — с мая 2022 года или позже, а на прогноз по знаку зодиака — с августа 2022 года или позже.

Механизмы идентификации, аутентификации и внесения оплаты не рассматриваем. Алгоритмы расчетов прогнозов не рассматриваем.

Задание 1

Спроектируйте концептуальную модель данных.

Результат: E/R-диаграмма

Задание 2

На основе концептуальной модели постройте реляционную базу данных. Проверьте, что база данных соответствует требованиям третьей нормальной формы.

Результат: скрипт с командами создания таблиц (create table t(a int primary key)).

Первичные ключи указывать обязательно. Внешние ключи и другие ограничения (not null, check, default) — по желанию.

Задание 3

Напишите SQL-запрос, рассчитывающий суммы оплат от каждого пользователя за текущий календарный год.

Результат: (логин, сумма).

Задание 4

Напишите SQL-запрос, который найдет все уникальные пары пользователей, которые оба были подписаны на одинаковый вид прогноза в некотором месяце.

Результат: (userlogin1, userlogin2).

Можно одну пару вывести дважды в разном порядке: (user1,user2) и (user2,user1), а можно только один раз в произвольном порядке.

Задание 5

Написать SQL-запрос, который найдет все пары пользователей, которые оба были подписаны на одинаковый вид прогноза в двух или больше месяцах (не обязательно подряд, но вид прогноза во все месяцы должен быть одинаковым).

Результат: (userlogin1, userlogin2). Можно одну пару вывести дважды в разном порядке: (user1,user2) и (user2,user1), а можно только один раз в произвольном порядке.

Задание 6

Написать SQL-запрос, который найдет подписки, нарушающие ограничения на их даты.

Результат: два id подписок.

Форма сдачи

Соберите все артефакты в одном месте: Google-документе, Яндекс-документе или доске Miro, откройте к нему доступ и пришлите ссылку.
 

Система оценивания

Понимание бизнес-кейса заказчика (2 балла):

Студент учел основные требования заказчика к функционалу БД и запросов к ней.
Студент учел все требования заказчика к функционалу БД и запросов к ней.
Качество определения сущностей и связей (2 балла):

Студент выделил основные сущности и их атрибуты.
Студент корректно определил связи между сущностями.
Нормализация данных (2 балла):

База фактически нормализована до третьей нормальной формы.
Студент продемонстрировал (описал) выполнение требований третьей нормальной формы.
Корректность запросов (по 1 баллу за каждый тип запроса):

Запрос к БД позволяет получить необходимую информацию.
Максимум за эту работу можно получить 10 баллов.
 

Задание 6 позволяет заработать дополнительные баллы.*